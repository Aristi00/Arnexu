<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear| Arnexu</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/config.js?v=1.0.1"></script>
<script src="js/app.js?v=1.0.1"></script>
<script src="js/badge-notifications.js?v=1.0.0"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-content">
            <a href="inicio.html"><img src="arnexu-64x (1).png" alt="Logo Arnexu"></a>
      <ul class="navbar-menu">
        <li><a href="inicio.html">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          
        </a></li>
        <li><a href="crear.html">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
          
        </a></li>
        <li><a href="chat.html">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          
        </a></li>
        <li><a href="perfil.html">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          
        </a></li>
        <li><a href="#" onclick="logout()" style="color: var(--error);">
          <svg width="27" height="27" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          
        </a></li>
      </ul>
    </div>
  </nav>
  <!-- Contenido Principal -->
  <div class="container" style="margin-top: 30px;">
    <h2 style="margin-bottom: 25px; font-size: 28px;">
      Comparte tu Proyecto
    </h2>

    <div style="background: var(--gris-oscuro); padding: 30px; border-radius: 12px; border: 1px solid var(--gris-medio);">
      <form id="crearPublicacionForm">
        <!-- TÃ­tulo -->
        <div class="form-group">
          <label class="form-label">TÃ­tulo de tu idea o proyecto *</label>
          <input 
            type="text" 
            id="titulo" 
            class="form-input" 
            placeholder="Ej: Plataforma de delivery para restaurantes locales"
            required
            maxlength="100"
          >
          <small style="color: var(--gris-neon); font-size: 12px;">
            <span id="tituloCount">0</span>/100 caracteres
          </small>
        </div>

        <!-- Tipo de PublicaciÃ³n -->
        <div class="form-group">
          <label class="form-label">Tipo de publicaciÃ³n *</label>
          <select id="tipo" class="form-select" required>
            <option value="">Selecciona una opciÃ³n</option>
            <option value="idea">ğŸ’¡ Solo una idea</option>
            <option value="proyecto">ğŸš€ Proyecto en desarrollo</option>
            <option value="otro">ğŸ“Œ Otro</option>
          </select>
        </div>

        <!-- DescripciÃ³n -->
        <div class="form-group">
          <label class="form-label">Describe tu idea *</label>
          <textarea 
            id="descripcion" 
            class="form-textarea" 
            placeholder="Explica tu proyecto: Â¿QuÃ© problema resuelve? Â¿CÃ³mo funciona? Â¿QuÃ© lo hace Ãºnico?"
            required
            style="min-height: 200px;"
          ></textarea>
          <small style="color: var(--gris-neon); font-size: 12px;">
            Sin lÃ­mite de caracteres - SÃ© lo mÃ¡s detallado posible
          </small>
        </div>

        <!-- CategorÃ­a -->
        <div class="form-group">
          <label class="form-label">CategorÃ­a *</label>
          <select id="categoria" class="form-select" required>
            <option value="">Selecciona una categorÃ­a</option>
            <option value="E-commerce">ğŸ›’ E-commerce</option>
            <option value="Bienes RaÃ­ces">ğŸ˜ï¸ Bienes RaÃ­ces</option>
            <option value="Alimentos">ğŸ” Alimentos</option>
            <option value="Finanzas">ğŸ’° Finanzas</option>
            <option value="Salud">ğŸ¥ Salud</option>
            <option value="EducaciÃ³n">ğŸ“š EducaciÃ³n</option>
            <option value="TecnologÃ­a">ğŸ’» TecnologÃ­a</option>
            <option value="Moda">ğŸ‘— Moda</option>
            <option value="Entretenimiento">ğŸ¬ Entretenimiento</option>
            <option value="Servicios">ğŸ”§ Servicios</option>
            <option value="Turismo">âœˆï¸ Turismo</option>
            <option value="Deportes">âš½ Deportes</option>
            <option value="Sostenibilidad">ğŸŒ± Sostenibilidad</option>
            <option value="Otro">ğŸ“Œ Otro</option>
          </select>
        </div>

        <!-- Adjuntar Archivos -->
        <div class="form-group">
          <label class="form-label">Adjuntar archivos (Opcional)</label>
          <input 
            type="file" 
            id="archivos" 
            class="form-file" 
            accept="image/*,video/*,.pdf,.doc,.docx"
            multiple
          >
          <label for="archivos" class="form-file-label" style="width: 100%;">
            ğŸ“ Seleccionar archivos (imÃ¡genes, videos, documentos)
          </label>
          <div id="archivosPreview" style="margin-top: 15px;"></div>
        </div>

        <!-- Contratos Digitales (PrÃ³ximamente) -->
        <div style="background: var(--gris-medio); padding: 20px; border-radius: 8px; margin-bottom: 25px; text-align: center;">
          <p style="color: var(--gris-neon); font-size: 14px;">
            ğŸ“„ <strong>Contratos Digitales</strong><br>
            PrÃ³ximamente podrÃ¡s adjuntar contratos digitales a tus publicaciones
          </p>
        </div>

        <!-- Botones -->
        <div style="display: flex; gap: 15px;">
          <button type="submit" class="btn btn-primary" style="flex: 1;">
            PUBLICAR PROYECTO
          </button>
          <a href="inicio.html" class="btn btn-secondary" style="flex: 1;">
            CANCELAR
          </a>
        </div>
      </form>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script>
    let usuarioActual = null;

    // ============================================
    // PROTEGER PÃGINA Y CARGAR USUARIO
    // ============================================
    async function inicializar() {
      await protegerPagina();
      usuarioActual = await getCurrentUser();
    }

    inicializar();

    // ============================================
    // CONTADOR DE CARACTERES DEL TÃTULO
    // ============================================
    document.getElementById('titulo').addEventListener('input', (e) => {
      document.getElementById('tituloCount').textContent = e.target.value.length;
    });

    // ============================================
    // PREVIEW DE ARCHIVOS
    // ============================================
    document.getElementById('archivos').addEventListener('change', (e) => {
      const archivos = Array.from(e.target.files);
      const preview = document.getElementById('archivosPreview');
      
      if (archivos.length === 0) {
        preview.innerHTML = '';
        return;
      }

      preview.innerHTML = `
        <div style="background: var(--gris-medio); padding: 15px; border-radius: 8px;">
          <strong style="color: var(--acento);">Archivos seleccionados:</strong>
          <ul style="margin-top: 10px; padding-left: 20px; color: var(--gris-neon);">
            ${archivos.map(f => `<li>${f.name} (${(f.size / 1024 / 1024).toFixed(2)} MB)</li>`).join('')}
          </ul>
        </div>
      `;
    });

    // ============================================
    // CREAR PUBLICACIÃ“N
    // ============================================
    document.getElementById('crearPublicacionForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const titulo = document.getElementById('titulo').value.trim();
      const tipo = document.getElementById('tipo').value;
      const descripcion = document.getElementById('descripcion').value.trim();
      const categoria = document.getElementById('categoria').value;
      const archivosInput = document.getElementById('archivos').files;

      // Validaciones
      if (!titulo || !tipo || !descripcion || !categoria) {
        mostrarNotificacion('Por favor completa todos los campos obligatorios', 'error');
        return;
      }

      try {
        // Subir archivos (si hay)
        const archivosUrls = [];
        if (archivosInput.length > 0) {
          for (const archivo of archivosInput) {
            const nombreArchivo = `${usuarioActual.id}_${Date.now()}_${archivo.name}`;
            const { data, error } = await window.supabaseClient.storage
              .from('arnexu-files')
              .upload(`publicaciones/${nombreArchivo}`, archivo);

            if (!error) {
              const { data: urlData } = window.supabaseClient.storage
                .from('arnexu-files')
                .getPublicUrl(`publicaciones/${nombreArchivo}`);
              archivosUrls.push({
                url: urlData.publicUrl,
                nombre: archivo.name,
                tipo: archivo.type
              });
            }
          }
        }

        // Crear publicaciÃ³n en la base de datos
        const { data, error } = await window.supabaseClient
          .from('publicaciones')
          .insert([{
            usuario_id: usuarioActual.id,
            titulo: titulo,
            tipo: tipo,
            descripcion: descripcion,
            categoria: categoria,
            archivos: archivosUrls,
            likes_count: 0
          }])
          .select();

        if (error) throw error;

        mostrarNotificacion('Â¡PublicaciÃ³n creada exitosamente!');
        setTimeout(() => {
          window.location.href = 'inicio.html';
        }, 1500);

      } catch (error) {
        console.error('Error creando publicaciÃ³n:', error);
        mostrarNotificacion('Error al crear la publicaciÃ³n. Intenta de nuevo.', 'error');
      }
    });
  </script>

    <!-- Agregar al final del body en todas las pÃ¡ginas -->
<div id="cookieBanner" style="display: none; position: fixed; bottom: 0; left: 0; right: 0; background: var(--gris-oscuro); padding: 20px; border-top: 2px solid var(--acento); z-index: 10000;">
  <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 20px;">
    <p style="color: var(--gris-neon); margin: 0;">
      ğŸª Usamos cookies para mejorar tu experiencia. 
      <a href="cookies.html" style="color: var(--acento);">MÃ¡s informaciÃ³n</a>
    </p>
    <button onclick="aceptarCookies()" class="btn btn-primary">
      Aceptar
    </button>
  </div>
</div>

<script>
function aceptarCookies() {
  localStorage.setItem('cookies_aceptadas', 'true');
  document.getElementById('cookieBanner').style.display = 'none';
}

// Mostrar banner si no ha aceptado
if (!localStorage.getItem('cookies_aceptadas')) {
  document.getElementById('cookieBanner').style.display = 'block';
}
</script>
</body>
<footer style="background: var(--gris-oscuro); padding: 30px; margin-top: 50px; border-top: 1px solid var(--gris-medio); text-align: center;">
  <p style="color: var(--gris-neon); margin-bottom: 15px;">Â© 2025 Arnexu. Todos los derechos reservados.</p>
  <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
    <a href="legal.html" style="color: var(--gris-neon);">Documentos Legales</a>
    <a href="terminos.html" style="color: var(--gris-neon);">TÃ©rminos</a>
    <a href="privacidad.html" style="color: var(--gris-neon);">Privacidad</a>
    <a href="cookies.html" style="color: var(--gris-neon);">Cookies</a>
    <a href="confidencialidad.html" style="color: var(--gris-neon);">Confidencialidad</a>
  </div>
</footer>
</html>